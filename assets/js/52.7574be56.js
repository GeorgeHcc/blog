(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{382:function(s,a,e){"use strict";e.r(a);var n=e(4),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("上节课我们从会议系统本身的基础配置出发，系统讲解并演示了会议系统部署到线上后云服务器需要注意的点，以及信令服务、流媒体服务、"),a("code",[s._v("WebRTC")]),s._v("网关服务、网络穿透服务如何配置在前端项目中，同时我们也实际操作，将信令服务和会议系统前端文件结合通过 "),a("code",[s._v("Nginx")]),s._v("映射到指定的域名，并让其支持"),a("code",[s._v("HTTPS")]),s._v("访问。")]),s._v(" "),a("p",[s._v("这节课，我们的核心是会议服务容器化，容器化对于现在云原生时代而言是必要的，通过容器我们可以更方便的管理和迁移我们的各种服务。")]),s._v(" "),a("h2",{attrs:{id:"基础服务容器化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础服务容器化"}},[s._v("#")]),s._v(" 基础服务容器化")]),s._v(" "),a("p",[s._v("首先从信令服务出发，将信令服务容器化。容器化的方式我们则通过 Docker 容器来承载基础服务，那么第一步应该是制作特定的"),a("code",[s._v("Dockerfile")]),s._v("文件。")]),s._v(" "),a("p",[a("code",[s._v("Dockerfile")]),s._v("文件是自有服务制作 Docker 镜像的核心文件，我们现在用到的 Docker 镜像都离不开该文件。")]),s._v(" "),a("ul",[a("li",[s._v("第一行：信令服务需要依赖 "),a("code",[s._v("Node")]),s._v("环境，因此我们的基准镜像选择 "),a("code",[s._v("node:14.21.0-buster")]),s._v("。")]),s._v(" "),a("li",[s._v("第二行：需要注意的是时区，如果当前服务依赖对时间有严格要求的，请注意时区配置。"),a("code",[s._v("Docker")]),a("strong",[s._v("容器默认时区是")]),s._v(" "),a("strong",[a("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%E5%8D%8F%E8%B0%83%E4%B8%96%E7%95%8C%E6%97%B6%2F787659",target:"_blank",rel:"noopener noreferrer"}},[s._v("UTC"),a("OutboundLink")],1)]),s._v(" "),a("strong",[s._v("，此时如果获取服务器时间则比北京时间少8小时")]),s._v("。")]),s._v(" "),a("li",[s._v("第三行："),a("code",[s._v("CMD")]),s._v("表示自定义的命令，这里我输出的是一段话。")]),s._v(" "),a("li",[s._v("第四行：拷贝文件夹到容器内部。我们所有的核心"),a("code",[s._v("服务")]),s._v("就是这个文件夹，因此需要将这些文件拷贝到镜像中去，后面根据镜像启动容器的时候才可以找到对应的"),a("code",[s._v("服务")]),s._v("。")]),s._v(" "),a("li",[s._v("第五行：设置工作空间，即容器默认启动的工作目录。")]),s._v(" "),a("li",[s._v("第六行："),a("code",[s._v("ENTRYPOINT")]),s._v("，容器启动后需要执行的命令。这个命令只有在启动容器的时候才会执行，构建镜像的时候不会。")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[s._v("dockerfile复制代码FROM node:14.21.0-buster\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" TZ=Asia/Shanghai")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo 信令服务器启动 dist目录为音视频前端目录，请使用nginx代理后访问，代理前端口：18080"')])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" ./server /server")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /server")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app.js"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("整体目录")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ead305f879e84f9299a2d68c237cef75~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("构建 Docker 镜像")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("shell复制代码"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在Dockerfile文件同目录执行下面语句 -t 表示指定的标签+版本号 ；不要网络后面那个点")]),s._v("\nroot@VM-4-3-ubuntu:/home/ubuntu/suke-nrtc"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t suke-media-nrtc:2.0  .")]),s._v("\nSending build context to Docker daemon  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v(".83MB\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/6 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM node:14.21.0-buster\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" bd24482b8c86\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/6 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ENV "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TZ")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Asia/Shanghai\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 1331b3ea89ea\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/6 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" CMD "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo 信令服务器启动 dist目录为音视频前端目录，请使用nginx代理后访问，代理前端口：18080"')]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 1a642db0ce12\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/6 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" COPY ./server /server\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" c0e2a8a0009e\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("/6 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" WORKDIR /server\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dfcf81c0644c\nStep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("/6 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" b0ddd996a31d\nSuccessfully built b0ddd996a31d\nSuccessfully tagged suke-media-nrtc:2.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[a("strong",[s._v("构建完成后启动容器")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("--name")]),s._v("：指定容器名称；"),a("code",[s._v("--restart")]),s._v(" ：自动重启，比如服务器关机重启后，容器会自动重启； "),a("code",[s._v("-p： 宿主机端口:容器内部服务暴露端口")]),s._v("；最后面参数为上一步构建的"),a("code",[s._v("镜像+版本")]),s._v("。")])]),s._v(" "),a("div",{staticClass:"language-css line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[s._v("css\n复制代码sudo docker run -d --name suke-media-nrtc --restart=always  -p 18080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("18080 "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("suke-media-nrtc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("2.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"前后端分离容器化部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前后端分离容器化部署"}},[s._v("#")]),s._v(" 前后端分离容器化部署")]),s._v(" "),a("p",[s._v("上一步容器化部署是将会议前端和信令服务结合一起部署的，但是有些人并不想前端和后端信令服务绑定到一起，因此就需要拆分部署，也就是所谓的前端和后端分离部署，这个时候就需要用到"),a("code",[s._v("Nginx")]),s._v("了。")]),s._v(" "),a("p",[s._v("我们先大体上梳理下，前后分离部署的基础步骤：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59ef82eb205d48a78fa8de0d454fe657~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),a("p",[s._v("本质上和基础服务容器化一样，都是制作自己的镜像，接下来我们按照上图中的内容步骤制作我们自己的镜像。")]),s._v(" "),a("ol",[a("li",[s._v("准备 Nginx 配置文件 "),a("code",[s._v("nginx.conf")]),s._v("。")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("server_name")]),s._v(" 绑定自己的域名即可。")]),s._v(" "),a("p",[s._v("注意下面的两个路径 "),a("code",[s._v("/usr/web/nginx/ssl")]),s._v("、"),a("code",[s._v("/usr/web/nginx/html")]),s._v("，一个是"),a("code",[s._v("SSL")]),s._v("证书位置，一个是前端静态文件夹。")]),s._v(" "),a("p",[a("code",[s._v("/signal-api/")]),s._v("为"),a("code",[s._v("Nginx")]),s._v("代理路径。被代理的服务地址："),a("code",[s._v("proxy_pass http://x.x.x.x;")]),s._v("。")])]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[s._v('ini复制代码server {\nlisten       19003 ssl;\nserver_name  localhost;\nclient_max_body_size 1024M;\nssl_certificate /usr/web/nginx/ssl/cert.crt;\nssl_certificate_key /usr/web/nginx/ssl/private.key;\nssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;\naccess_log  /var/log/nginx/host.access.log  main;\nerror_log  /var/log/nginx/error.log  error;\nlocation / {\n    root   /usr/web/nginx/html;\n    index  index.html index.htm;\n}\n location  /signal-api/ {\n            proxy_pass http://x.x.x.x:18088; # 信令服务地址配置\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n        }\nerror_page   500 502 503 504  /50x.html;\n'),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("/50x.html {")]),s._v("\n    root   /usr/share/nginx/html;\n}\n} \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("ol",[a("li",[s._v("制作镜像基准文件 Dockerfile。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("bash复制代码"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基准镜像")]),s._v("\nFROM nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝前端资源")]),s._v("\nCOPY ./dist /usr/web/nginx/html/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝SSL证书")]),s._v("\nCOPY ./ssl /usr/web/nginx/ssl/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝 nginx配置文件")]),s._v("\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 声明暴露端口")]),s._v("\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19003")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ol",[a("li",[s._v("修改会议前端"),a("code",[s._v("Prod")]),s._v("环境信令服务地址。")])]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[s._v("ini\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("复制代码Vue.prototype.$serverSocketUrl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("process.env.NODE_ENV === 'development' ? 'ws://127.0.0.1:18080' : '/signal-api/'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",[a("li",[s._v("准备好上述文件开始构建镜像。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("bash复制代码"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dockerfile 所在目录执行命令 注意看下图")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" test-online-meeting:1.0.2 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3bebdc721cb547ff9fe6ac7ab230894e~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),a("ol",[a("li",[s._v("启动容器。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("shell复制代码"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里 --rm 为 停止后自动删除退出容器 仅用于测试 正式部署去掉--rm 并使用 -d 后台进程执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 19003 为前面声明的 Nginx 配置文件中的端口，同时宿主机端口也是19003 【-p 宿主机端口:容器内服务端口】")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19003")]),s._v(":19003 test-online-meeting:1.0.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0a0e9a5477449339064568203aa25a9~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8e38244db0ac4a7f8855aa98f497ccfc~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),a("p",[s._v("这里"),a("code",[s._v("SSL")]),s._v("证书为自签名测试证书，因此浏览器不信任，不过可以继续访问。正式环境请使用"),a("code",[s._v("443端口")]),s._v("+域名的正式"),a("code",[s._v("SSL")]),s._v("证书。")]),s._v(" "),a("h2",{attrs:{id:"注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[s._v("#")]),s._v(" 注意事项")]),s._v(" "),a("p",[s._v("前后端分离部署后，对于服务管理和迁移虽然方便了很多，而且所有的过程仅需要脚本就能自动化部署，搭配现有的各种自动化工具也是很方便的，比如 Jenkins、k8s、k3s 等，但是对于不熟悉的人而言会遇到很多问题。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("nginx")]),s._v("路径配置问题。这个算是前后端分离部署后所有项目必须要解决的一个问题，不仅仅是我们的会议系统。比如我前面配置的 "),a("code",[s._v("location /signal-api/ {}")]),s._v("信令服务路径，那么你在前端线上环境也要同步做出更改，否则前端无法找到对应的 API 接口服务。")]),s._v(" "),a("li",[s._v("端口映射问题。"),a("code",[s._v("nginx")]),s._v("暴露端口必须要在启动容器的时候映射出去，否则服务无法访问。")]),s._v(" "),a("li",[s._v("静态资源频繁变更问题。上面我们一开始就将静态资源打到镜像里面了，这种方法对于频繁更改的文件而言并不是很友好，因此我们可以优化下，将静态资源通过动态挂载的方式绑定到宿主机文件系统中。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("bash复制代码"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /home/html/dist 为宿主机文件位置 /usr/web/nginx/html/为容器内nginx映射的资源位置。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19003")]),s._v(":19003 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /home/html/dist:/usr/web/nginx/html/ test-online-meeting:1.0.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[s._v("#")]),s._v(" 最后")]),s._v(" "),a("p",[s._v("在实际的企业应用部署中，大多数服务部署都和这两节部署实战课所讲的方式大同小异，希望学完部署实战的内容，不仅仅对于我们自身会议系统的部署有所帮助，对于大家在实际工作中所有的服务部署都能起到推进作用。")]),s._v(" "),a("p",[s._v("这节课是我们课程的最后一节，从第一节的基础知识，到使用"),a("code",[s._v("WebRTC")]),s._v("打造三种架构直播会议系统实战，再到系统的部署实战，我们算是从 0 到 1 系统性地熟悉了 "),a("code",[s._v("WebRTC")]),s._v("这门技术，这也算是目前为止全网第一本将"),a("code",[s._v("WebRTC")]),s._v("+各种开源流媒体组合打造多样性应用的课程，"),a("strong",[s._v("希望这节课仅仅是本课程的最后一节，更是你开启前端音视频的第一节课，是大家将技术带入实际工作的第一节课")]),s._v("。")]),s._v(" "),a("p",[s._v("加油！我们共同进步，后续有任何疑问评论区或者社群大家一起交流。课程会停止，但是技术会一直迭代更新，而我们更需要持续的进步。")])])}),[],!1,null,null,null);a.default=t.exports}}]);