(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{380:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("到这里我们会议系统的学习和实战算是整体告一段落了，接下来的两节课，我们将写好的会议系统部署到线上，以及学习在部署过程中需要注意的一些问题。")]),s._v(" "),t("p",[s._v("部署之前，我们需要准备好项目中用到的一些服务的配置。")]),s._v(" "),t("h2",{attrs:{id:"基础配置注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基础配置注意事项"}},[s._v("#")]),s._v(" 基础配置注意事项")]),s._v(" "),t("p",[s._v("会议系统需要获取用户的摄像头、麦克风等敏感设备信息，访问协议必须是"),t("code",[s._v("HTTPS")]),s._v("（"),t("a",{attrs:{href:"https://juejin.cn/book/7168418382318927880/section/7171376753263247396",target:"_blank",rel:"noopener noreferrer"}},[s._v("《02|"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"https://juejin.cn/book/7168418382318927880/section/7171376753263247396",target:"_blank",rel:"noopener noreferrer"}},[s._v("基础（一）：Web 端基础 API 学习》"),t("OutboundLink")],1),s._v("章节详细介绍过），因此部署后必须配置"),t("code",[s._v("SSL")]),s._v("证书。再一个就是需要特别注意线上部署后云服务器"),t("code",[s._v("安全组")]),s._v("开放的问题，默认购买云服务器后，是无法直接访问特定端口的，必须在对应厂商的控制台安全组中开放端口才可以。")]),s._v(" "),t("h3",{attrs:{id:"信令服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#信令服务"}},[s._v("#")]),s._v(" 信令服务")]),s._v(" "),t("p",[s._v("我们在学到第一种 "),t("code",[s._v("Mesh")]),s._v("多人会议架构时用到了信令交换服务器，信令服务器是 "),t("code",[s._v("WebRTC")]),s._v("基础信令交换的核心，因此会议系统前端部署之前，我们必须配置好信令服务器。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("javascript复制代码"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//获取当前项目访问协议")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" protocol "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("protocol "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https:'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wss://'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ws://'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" window"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("host\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" protocol"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("host\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//根据环境自动选择服务器配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" serverSocketUrl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'development'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ws://127.0.0.1:18080'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" server\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$serverSocketUrl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serverSocketUrl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("请注意我上面的服务器地址配置，获取的是当前访问的 IP 或域名的基础信息，比如当前的前端项目打包后被部署到域名"),t("code",[s._v("https://www.xxxxx.zyx")]),s._v("下，那么信令服务地址则是："),t("code",[s._v("wss``://www.xxxxx.zyx")]),s._v("，而如果本地访问则地址是"),t("code",[s._v("ws://127.0.0.1:18080")]),s._v("。")]),s._v(" "),t("p",[s._v("当然我上面的配置是因为信令服务器和前端项目在同一个域名路径下，如果大家的信令服务器和会议前端不在一块部署，则自己可以将"),t("code",[s._v("serverSocketUrl")]),s._v("变量替换为自己的信令服务器，但是请注意 "),t("strong",[s._v("跨域和访问协议的问题")]),s._v("，如"),t("strong",[s._v("果你的会议前端访问协议为")]),s._v(" "),t("strong",[t("code",[s._v("HTTPS")])]),s._v(" "),t("strong",[s._v("，那么这里的信令服务地址必须为")]),s._v(" "),t("strong",[t("code",[s._v("HTTPS")])]),s._v("，"),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fweb.dev%2Fwhat-is-mixed-content%2F%23_11",target:"_blank",rel:"noopener noreferrer"}},[s._v("相关知识参考"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("在我们的课程中为了避免部署的繁琐，我一开始就在信令服务器配置了静态文件夹映射，因此你可以直接将打包后的前端静态文件放到指定文件夹，然后直接"),t("strong",[s._v("访问信令服务器的 IP端口即可")]),s._v("，线上部署之后，通过"),t("code",[s._v("nginx")]),s._v("直接映射信令服务器的端口。")]),s._v(" "),t("p",[t("strong",[s._v("信令服务和静态文件映射部分配置")]),s._v(" "),t("strong",[s._v("：")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("javascript复制代码"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//http server 这里配置前端打包后的静态文件 ")]),s._v("\napp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("express"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("static")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./dist'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\napp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendfile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./dist/index.html'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//路径根据自己文件配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createServer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//socket server")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" io "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'socket.io'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowEIO3")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//自定义命令空间  nginx代理 /mediaServerWsUrl { http://xxxx:18080/socket.io/ }")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// io = io.of('mediaServerWsUrl')")]),s._v("\nserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'服务器启动成功 *:18080'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("strong",[s._v("Nginx 映射配置")]),s._v(" "),t("strong",[s._v("：")])]),s._v(" "),t("div",{staticClass:"language-conf line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('conf复制代码server {\n  server_name www.xxxxx.zyx;\n  listen 443 ssl http2;\n  ssl_certificate /home/nginxWebUI/letsebcrypt/cert.crt;\n  ssl_certificate_key /home/nginxWebUI/letsebcrypt/private.key;\n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;\n  listen 80;\n  # http重定向到https\n  if ($scheme = http) {\n    return 301 https://$host:443$request_uri;\n  }\n  location / {\n    proxy_pass http://127.0.0.1:18080/; # 这里就是信令服务启动的服务地址\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Host $http_host;\n    proxy_set_header X-Forwarded-Port $server_port;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    ## 信令核心配置 必须开启支持 websocket \n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "upgrade";\n    proxy_redirect http:// https://;\n  }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h3",{attrs:{id:"webrtc-网关服务器配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webrtc-网关服务器配置"}},[s._v("#")]),s._v(" WebRTC 网关服务器配置")]),s._v(" "),t("p",[s._v("第二种 "),t("code",[s._v("SFU")]),s._v(" 架构会议系统中，我们用到了"),t("code",[s._v("Janus")]),s._v("网关服务器，因此抽取全局变量后如下：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("javascript复制代码"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Janus地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果为dev环境 直接配置绝对路径 否咋配置相对路径（如果前端不在janus所在服务器 则直接用映射后的地址 ）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$janusServerUrl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'development'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://www.xxxxxx.zyx/suke-janus/janus/'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/suke-janus/janus/'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("Nginx 代理配置（注意上下对比看代理路径：代理前的 "),t("code",[s._v("Janus")]),s._v("地址："),t("code",[s._v("http://x.x.x.x:18088")]),s._v("）：")]),s._v(" "),t("div",{staticClass:"language-perl line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-perl"}},[t("code",[s._v("perl复制代码 location "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("suke"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("janus "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    proxy_pass http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token regex"}},[s._v("//x")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("x")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18088")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 这里配置网关 janus地址  ")]),s._v("\n    proxy_set_header Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Port "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Proto "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_redirect http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token regex"}},[s._v("//")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("项目中变量引用：")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("javascript复制代码janus "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Janus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" that"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$janusServerUrl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//全局配置")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("apisecret")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'suc119119'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//这个变量也可以弄成全局的")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("success")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        Janus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"初始化成功"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        that"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("initVideoRoomPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("cause")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//异常显示")]),s._v("\n                        Janus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cause"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("destroyed")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        Janus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"destroyed"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"网络穿透服务器配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网络穿透服务器配置"}},[s._v("#")]),s._v(" 网络穿透服务器配置")]),s._v(" "),t("p",[t("code",[s._v("STUN")]),s._v("和"),t("code",[s._v("TURN")]),s._v("配置。如果你的项目部署在公网，这个配置是不可避免的，毕竟全球各地的网络状况是复杂多变的。同时如果你的客户是针对国内外的，那么强烈建议使用中继，即 "),t("code",[s._v("TURN")]),s._v("服务器，作为流量中继，而 "),t("code",[s._v("TURN")]),s._v("服务部署位置选择国内外都可以访问的区域，比如购买区域在香港的云服务器。")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("javascript复制代码rtcPcParams")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("iceServers")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stun:stun.l.google.com:19302"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 谷歌的公共服务")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("urls")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'turn:x.x.x.x:3478'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'suc'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("credential")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'suc001'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//turn服务 自建 可以配置多个")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("参数调用位置"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\npc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PeerConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rtcPcParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"流媒体服务地址配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#流媒体服务地址配置"}},[s._v("#")]),s._v(" 流媒体服务地址配置")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("javascript复制代码"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//SRS相关地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$srsServerAPIURL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://192.168.101.99:1985/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$srsServerRTCURL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webrtc://192.168.101.99:8085/live/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$srsServerFlvURL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://192.168.101.99:8085/live/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("上面三个地址为全局变量，代码中也是通过全局变量引用。")]),s._v(" "),t("div",{staticClass:"language-kotlin line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-kotlin"}},[t("code",[s._v("kotlin复制代码"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//推流SDP交换")]),s._v("\naxios"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$srsServerAPIURL"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("'rtc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("publish"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("'"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("上面配置的地址，如果你线上使用的"),t("code",[s._v("HTTPS")]),s._v("协议，那么项目内部"),t("code",[s._v("API")]),s._v("请求也需要配置"),t("code",[s._v("HTTPS")]),s._v("，同样可通过"),t("code",[s._v("nginx")]),s._v("代理。")]),s._v(" "),t("h3",{attrs:{id:"服务器端口配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器端口配置"}},[s._v("#")]),s._v(" 服务器端口配置")]),s._v(" "),t("p",[s._v("我们在会话过程中会遇到很多端口，部署到线上阿里云、腾讯云等云厂商服务器后，需要去安全组开放特定的端口，这样外部才能进行访问。这里我将常见的需要大家注意的端口着重说明下：")]),s._v(" "),t("ul",[t("li",[s._v("信令服务器端口：项目中默认配置的"),t("code",[s._v("18080")]),s._v("，大家可以自定义，然后在安全组放行。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d029c4ba4d2c49449069e73395c98db0~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("ul",[t("li",[s._v("WebRTC 网关 Janus 服务 API 端口，示例中为"),t("code",[s._v("18088")]),s._v("，安全组需要放行。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2e682dea9214631990df0bbdfe47b2d~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("ul",[t("li",[s._v("Janus 网关 RTP 数据交换端口。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee452aad36af4c7f925c178aacd0b229~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("ul",[t("li",[t("code",[s._v("coturn")]),s._v("服务端口，看下图红色框框中的端口配置。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4d803e7481046fb83547f9f2eb18ded~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"实战部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战部署"}},[s._v("#")]),s._v(" 实战部署")]),s._v(" "),t("ol",[t("li",[s._v("前端项目打包。")])]),s._v(" "),t("div",{staticClass:"language-arduino line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-arduino"}},[t("code",[s._v("arduino\n复制代码npm "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("run")]),s._v(" build\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",[t("li",[s._v("打包好的"),t("code",[s._v("dist")]),s._v("文件夹放到和信令服务同目录。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/843da2edf2ed407187d9daf3725d288f~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("ol",[t("li",[s._v("启动信令服务。")])]),s._v(" "),t("div",{staticClass:"language-markdown line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-markdown"}},[t("code",[s._v("markdown复制代码> node app.js\n服务器启动成功 *:18080\nredis 连接成功\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",[t("li",[s._v("浏览器输入信令服务 IP+端口。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efdccd1b04e143aab2b91e6bd03f9bba~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("ol",[t("li",[t("code",[s._v("Nginx")]),s._v("代理并绑定域名，注意域名配置成自己的，下面示例为我的线上域名。")])]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[s._v("ini复制代码server {\n  server_name nrtc.wangsrbus.cn;\n  listen 443 ssl http2;\n  ssl_certificate /home/nginxWebUI/letsebcrypt/cert.crt;\n  ssl_certificate_key /home/nginxWebUI/letsebcrypt/private.key;\n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;\n  listen 80;\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http重定向到https")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("if ($scheme")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("http) {")]),s._v("\n    return 301 https://$host:443$request_uri;\n  }\n  location / {\n    proxy_pass http://127.0.0.1:18080/; # 这里就是信令服务启动的服务地址,看上一步访问地址\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Host $http_host;\n    proxy_set_header X-Forwarded-Port $server_port;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 信令核心配置 必须开启支持 websocket ")]),s._v('\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "upgrade";\n    proxy_redirect http:// https://;\n  }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h2",{attrs:{id:"ssl-证书自动签发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssl-证书自动签发"}},[s._v("#")]),s._v(" SSL 证书自动签发")]),s._v(" "),t("p",[t("code",[s._v("SSL")]),s._v("证书有收费的，也有免费的。一般而言，我们在云厂商都可以针对单个域名免费申请 20 次且每次期限一年的"),t("code",[s._v("SSL")]),s._v("证书（下面是腾讯云的截图）。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7c6ce5b23db44c7aa056a0241fad27c~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("p",[s._v("我们的目的肯定是能自动化就自动化，方便维护。这里推荐一个工具：acme ("),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Facmesh-official%2Facme.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github地址"),t("OutboundLink")],1),s._v(")。通过此工具，我们可以自动申请和续期免费的"),t("code",[s._v("SSL")]),s._v("证书。")]),s._v(" "),t("h3",{attrs:{id:"工具下载安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工具下载安装"}},[s._v("#")]),s._v(" "),t("strong",[s._v("工具下载安装")])]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[s._v("ini复制代码# 注意下面的邮箱换成你自己的\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("curl https://get.acme.sh | sh -s email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1215618342@qq.com")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"开启自动更新"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启自动更新"}},[s._v("#")]),s._v(" "),t("strong",[s._v("开启自动更新")])]),s._v(" "),t("div",{staticClass:"language-css line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-css"}},[t("code",[s._v("css\n复制代码acme.sh --upgrade --auto-upgrade\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"切换-ca-类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#切换-ca-类型"}},[s._v("#")]),s._v(" "),t("strong",[s._v("切换 CA 类型")])]),s._v(" "),t("p",[s._v("目前 "),t("code",[s._v("acme.sh")]),s._v(" 支持四个正式环境 "),t("code",[s._v("CA")]),s._v("，分别是 "),t("code",[s._v("Let's Encrypt")]),s._v("、"),t("code",[s._v("Buypass")]),s._v("、"),t("code",[s._v("ZeroSSL")]),s._v("和 "),t("code",[s._v("SSL.com")]),s._v("，默认使用 "),t("code",[s._v("ZeroSSL")]),s._v("。我们一般使用"),t("code",[s._v("Let's Encrypt")]),s._v("就可以，既支持单域名，也支持通配符多域名证书（"),t("strong",[s._v("虽然通配符类型证书时间仅有3个月，但是好在我们有这个工具")]),s._v("）。切换"),t("code",[s._v("LE")]),s._v("类型命令如下：")]),s._v(" "),t("div",{staticClass:"language-vbscript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("vbscript\n复制代码acme.sh --set-default-ca --server letsencrypt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"泛域名仅支持-dns-验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#泛域名仅支持-dns-验证"}},[s._v("#")]),s._v(" "),t("strong",[s._v("泛域名仅支持")]),s._v(" "),t("strong",[s._v("DNS")]),s._v(" "),t("strong",[s._v("验证")])]),s._v(" "),t("p",[s._v("申请 API 密钥(DNSPod Token) "),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fconsole.dnspod.cn%2Faccount%2Ftoken%2Fapikey",target:"_blank",rel:"noopener noreferrer"}},[s._v("腾讯云API Key申请"),t("OutboundLink")],1),s._v("，每个厂商的DNS验证参数配置是不一样的额，如果你的域名不是腾讯云的那么请查看"),t("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Facmesh-official%2Facme.sh%2Fwiki%2Fdnsapi",target:"_blank",rel:"noopener noreferrer"}},[s._v("此文档"),t("OutboundLink")],1),s._v(" 。然后编辑 "),t("code",[s._v("acme")]),s._v("工具配置信息，如下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("bash复制代码cd ~/.acme.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" account.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 添加如下 dnspod 密钥")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DP_Id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxx"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DP_Key")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"12222222222"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"证书申请"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#证书申请"}},[s._v("#")]),s._v(" 证书申请")]),s._v(" "),t("blockquote",[t("p",[s._v("注意下面参数：dns_dp表示用腾讯云 "),t("code",[s._v("dnspos")]),s._v("验证 "),t("code",[s._v("-d webrtc.link -d *.webrtc.link")]),s._v("表示域名，自己的请配置自己的域名")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n复制代码acme.sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--issue")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dns")]),s._v(" dns_dp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" webrtc.link "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" *.webrtc.link --key-file /home/nginxWebUI/letsebcrypt/private-rtclink.key --fullchain-file /home/nginxWebUI/letsebcrypt/cert-rtclink.crt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("执行脚本后，观察域名解析信息，可以看到会自动增加两条解析：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bcbff5b4bd5a4c9aac5001d9baec5031~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("p",[s._v("申请成功则会打印如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b5803d2ba5d41eca253c9c245fb89f4~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("p",[s._v("我们访问配置对应证书后，查看浏览器对应提示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28b68324ce594a76a3bb2829d7b920c4~tplv-k3u1fbpfcp-jj-mark:1890:0:0:0:q75.awebp",alt:"img"}})]),s._v(" "),t("h2",{attrs:{id:"课后题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#课后题"}},[s._v("#")]),s._v(" 课后题")]),s._v(" "),t("p",[s._v("这节课后大家主要练习对于会议系统的部署，实际上大多数项目的部署都是如此，学会一种，后续自己的其他项目部署也是得心应手。对于自动签发"),t("code",[s._v("SSL")]),s._v("证书，大家可以多找几个域名试试，去找一年两三块钱那种多练习练习即可。")])])}),[],!1,null,null,null);t.default=e.exports}}]);